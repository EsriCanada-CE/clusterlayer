{"version":3,"sources":["../src/ClusterLayer.js"],"names":["define","GraphicsLayer","FeatureLayer","TextSymbol","Query","Graphic","webMercatorUtils","declare","lang","array","on","require","clusterRenderer","type","symbol","style","size","color","outline","width","visualVariables","field","minDataValue","maxDataValue","minSize","valueExpression","stops","value","maxSize","clusterFields","name","alias","clusterPopupTemplate","title","content","fieldInfos","fieldName","label","visible","clusterLabelSymbol","haloColor","haloSize","text","xoffset","yoffset","font","family","weight","createSubclass","constructor","opts","prop","this","featureLayerOpts","worker","Worker","toUrl","onmessage","hitch","e","data","workerReady","postMessage","supercluster","superclusterReady","clusterWorkerReady","view","initClusterLayer","indexReady","clusterIndexReady","requestClusters","displayClusters","url","source","initial","map","reduce","console","log","currentFeatures","currentClusters","allViews","clusterFieldNames","fields","concat","filter","indexOf","popupTemplate","labelsVisible","labelSymbol","labelField","labelFormatter","renderer","geometryType","spatialReference","wkid","objectIdField","inherited","arguments","applyEdits","promise","source_layer","apply","when","loadFeatures","createLayerView","mapView","push","labelGraphics","graphics","popupEnabled","add","destroyLayerView","splice","length","direct_url","load","then","definitionExpression","watch","newExp","oldExp","where","offset","workerOpts","mixin","features","direct_type","outFields","fieldname","query","num","maxRecordCount","start","outSpatialReference","returnGeometry","handleQueryResponse","results","esriObjectToJSON","exceededTransferLimit","queryFeatures","stationary","zoom","parseInt","Math","round","extent","webMercatorToGeographic","basemap","baseLayers","items","fullExtent","bbox","xmin","ymin","xmax","ymax","clusters","graphicFromGeoJson","removeAll","addMany","cluster","attributes","point_count","geometry","obj","toJSON","geoJson","longitude","coordinates","latitude","properties"],"mappings":"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","file":"ClusterLayer.js"}