{"version":3,"sources":["../src/ClusterLayer.js"],"names":["define","GraphicsLayer","FeatureLayer","TextSymbol","LabelClass","Query","Graphic","webMercatorUtils","declare","lang","array","on","require","clusterRenderer","type","symbol","style","size","color","outline","width","visualVariables","field","minDataValue","maxDataValue","minSize","valueExpression","stops","value","maxSize","clusterFields","name","alias","clusterPopupTemplate","title","content","fieldInfos","fieldName","label","visible","clusterLabelSymbol","haloColor","haloSize","text","xoffset","yoffset","font","family","weight","clusterLabelingInfo","labelExpressionInfo","expression","labelPlacement","createSubclass","properties","clusterIndexReady","source_definitionExpression","constructor","opts","prop","this","featureLayerOpts","worker","Worker","toUrl","onmessage","hitch","e","data","workerReady","postMessage","supercluster","superclusterReady","clusterWorkerReady","view","initClusterLayer","indexReady","requestClusters","displayClusters","val","url","definitionExpression","outFields","currentFeatures","currentClusters","allViews","clusterFieldNames","map","fields","concat","filter","indexOf","popupTemplate","labelWithGraphics","labelsVisible","labelingInfo","labelSymbol","labelField","renderer","geometryType","spatialReference","wkid","objectIdField","source","source_features","inherited","arguments","createLayerView","mapView","push","labelGraphics","graphics","add","opacity","watchView","destroyLayerView","splice","length","stationaryWatch","remove","scaleWatch","watch","direct_url","source_layer","load","then","newExp","oldExp","loadFeatures","console","log","where","offset","workerOpts","mixin","features","source_url","direct_type","fieldname","query","num","maxRecordCount","start","outSpatialReference","returnGeometry","handleQueryResponse","results","esriObjectToJSON","exceededTransferLimit","queryFeatures","stationary","popup","selectedFeature","layer","zoom","parseInt","Math","round","extent","webMercatorToGeographic","basemap","baseLayers","items","fullExtent","bbox","xmin","ymin","xmax","ymax","clusters","removeAll","currentClusterOIDs","applyEdits","deleteFeatures","clusterGeoJson","cluster","geoJson","geometry","longitude","coordinates","latitude","attributes","graphicFromGeoJson","point_count_abbreviated","toString","labelFormatter","addFeatures","edits","addFeatureResults","objectId","error","addMany","point_count","setTimeout","has_loaded","obj","toJSON"],"mappings":"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","file":"ClusterLayer.js"}