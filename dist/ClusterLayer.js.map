{"version":3,"sources":["../src/ClusterLayer.js"],"names":["define","GraphicsLayer","FeatureLayer","TextSymbol","LabelClass","Query","Graphic","webMercatorUtils","esriNS","declare","lang","array","Deferred","on","has","require","esriVersion","parseFloat","version","isWebGL","clusterRenderer","type","symbol","style","size","color","outline","width","visualVariables","field","minDataValue","maxDataValue","minSize","valueExpression","stops","value","maxSize","clusterFields","name","alias","clusterPopupTemplate","title","content","fieldInfos","fieldName","label","visible","clusterLabelSymbol","haloColor","haloSize","text","xoffset","yoffset","font","family","weight","clusterLabelingInfo","labelExpressionInfo","expression","labelPlacement","createSubclass","properties","clusterIndexReady","source_definitionExpression","constructor","opts","$this","this","prop","featureLayerOpts","worker","Worker","toUrl","onmessage","e","data","workerReady","postMessage","supercluster","superclusterReady","clusterWorkerReady","view","initClusterLayer","indexReady","requestClusters","displayClusters","val","url","definitionExpression","outFields","currentFeatures","currentClusters","allViews","clusterFieldNames","map","fields","concat","filter","indexOf","popupTemplate","labelsVisible","labelWithGraphics","labelingInfo","labelSymbol","labelField","renderer","geometryType","spatialReference","wkid","objectIdField","source","source_features","inherited","arguments","createLayerView","mapView","push","enableLabelGraphics","watchView","destroyLayerView","splice","length","labelGraphics","graphics","add","opacity","stationaryWatch","remove","scaleWatch","watch","stationary","refreshClusters","direct_url","source_layer","load","then","newExp","oldExp","loadFeatures","console","log","where","offset","workerOpts","mixin","features","source_url","direct_type","fieldname","query","num","maxRecordCount","start","outSpatialReference","returnGeometry","handleQueryResponse","results","esriObjectToJSON","exceededTransferLimit","queryFeatures","refresh_deferred","zoom","parseInt","Math","round","extent","webMercatorToGeographic","basemap","baseLayers","items","fullExtent","bbox","xmin","ymin","xmax","ymax","popup","selectedFeature","layer","clusters","addToSource","removeAll","addMany","addLabelGraphics","resolve","clusterGeoJson","cluster","geoJson","geometry","longitude","coordinates","latitude","attributes","graphicFromGeoJson","point_count_abbreviated","toString","labelFormatter","result","delete_ids","f","objectId","objectid","editFeatures","addFeatures","deleteFeatures","applyEdits","edits","point_count","setTimeout","has_loaded","obj","toJSON"],"mappings":"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","file":"ClusterLayer.js"}