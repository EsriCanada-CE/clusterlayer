{"version":3,"sources":["../src/ClusterLayer.js"],"names":["define","GraphicsLayer","FeatureLayer","TextSymbol","Query","Graphic","webMercatorUtils","declare","lang","array","on","require","clusterRenderer","type","symbol","style","size","color","outline","width","visualVariables","field","minDataValue","maxDataValue","minSize","valueExpression","stops","value","maxSize","clusterFields","name","alias","clusterPopupTemplate","title","content","fieldInfos","fieldName","label","visible","clusterLabelSymbol","haloColor","haloSize","text","xoffset","yoffset","font","family","weight","createSubclass","constructor","opts","prop","this","featureLayerOpts","worker","Worker","toUrl","onmessage","hitch","e","data","workerReady","postMessage","supercluster","superclusterReady","clusterWorkerReady","view","initClusterLayer","indexReady","clusterIndexReady","requestClusters","displayClusters","url","source","initial","map","reduce","console","log","currentFeatures","currentClusters","allViews","clusterFieldNames","fields","concat","filter","indexOf","popupTemplate","labelsVisible","labelSymbol","labelField","labelFormatter","renderer","geometryType","spatialReference","wkid","objectIdField","inherited","arguments","applyEdits","promise","source_layer","apply","when","loadFeatures","createLayerView","mapView","push","labelGraphics","graphics","add","destroyLayerView","splice","length","direct_url","load","then","definitionExpression","watch","newExp","oldExp","where","offset","features","direct_type","outFields","fieldname","query","num","maxRecordCount","start","outSpatialReference","returnGeometry","handleQueryResponse","results","esriObjectToJSON","exceededTransferLimit","queryFeatures","stationary","zoom","parseInt","Math","round","extent","webMercatorToGeographic","basemap","baseLayers","items","fullExtent","bbox","xmin","ymin","xmax","ymax","clusters","graphicFromGeoJson","removeAll","addMany","cluster","attributes","point_count","c","clone","mixin","obj","toJSON","geoJson","geometry","longitude","coordinates","latitude","properties"],"mappings":"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","file":"ClusterLayer.js"}