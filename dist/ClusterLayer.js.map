{"version":3,"sources":["../src/ClusterLayer.js"],"names":["define","GraphicsLayer","FeatureLayer","TextSymbol","LabelClass","Query","Graphic","webMercatorUtils","esriNS","declare","lang","array","on","has","require","esriVersion","version","split","esriVersionMajor","parseInt","esriVersionMinor","isWebGL","clusterRenderer","type","symbol","style","size","color","outline","width","visualVariables","field","minDataValue","maxDataValue","minSize","valueExpression","stops","value","maxSize","clusterFields","name","alias","clusterPopupTemplate","title","content","fieldInfos","fieldName","label","visible","clusterLabelSymbol","haloSize","text","xoffset","yoffset","font","family","weight","clusterLabelingInfo","labelExpressionInfo","expression","labelPlacement","createSubclass","properties","clusterIndexReady","source_definitionExpression","constructor","opts","$this","this","prop","featureLayerOpts","worker","Worker","toUrl","onmessage","e","data","workerReady","postMessage","supercluster","superclusterReady","clusterWorkerReady","view","initClusterLayer","indexReady","requestClusters","displayClusters","val","url","definitionExpression","outFields","currentFeatures","currentClusters","allViews","clusterFieldNames","map","fields","concat","filter","indexOf","popupTemplate","labelsVisible","labelWithGraphics","labelingInfo","labelSymbol","labelField","renderer","geometryType","spatialReference","wkid","objectIdField","source","source_features","inherited","arguments","createLayerView","mapView","push","enableLabelGraphics","watchView","destroyLayerView","splice","length","labelGraphics","graphics","add","opacity","stationaryWatch","remove","scaleWatch","watch","stationary","refreshClusters","direct_url","source_layer","load","then","newExp","oldExp","loadFeatures","console","log","where","offset","workerOpts","mixin","features","source_url","direct_type","fieldname","query","num","maxRecordCount","start","outSpatialReference","returnGeometry","handleQueryResponse","results","esriObjectToJSON","exceededTransferLimit","queryFeatures","requesting_clusters","zoom","Math","round","extent","webMercatorToGeographic","basemap","baseLayers","items","fullExtent","bbox","xmin","ymin","xmax","ymax","popup","selectedFeature","layer","clusters","addToSource","removeAll","addMany","addLabelGraphics","clusterGeoJson","cluster","geoJson","geometry","longitude","coordinates","latitude","attributes","graphicFromGeoJson","point_count_abbreviated","toString","labelFormatter","result","delete_ids","f","objectId","objectid","editFeatures","addFeatures","deleteFeatures","applyEdits","edits","point_count","setTimeout","has_loaded","obj","toJSON"],"mappings":"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","file":"ClusterLayer.js"}