{"version":3,"sources":["../src/ClusterLayer.js"],"names":["define","GraphicsLayer","FeatureLayer","TextSymbol","Query","Graphic","webMercatorUtils","declare","lang","array","on","require","clusterRenderer","type","symbol","style","size","color","outline","width","visualVariables","field","minDataValue","maxDataValue","minSize","valueExpression","stops","value","maxSize","clusterFields","name","alias","clusterPopupTemplate","title","content","fieldInfos","fieldName","label","visible","clusterLabelSymbol","haloColor","haloSize","text","xoffset","yoffset","font","family","weight","createSubclass","constructor","opts","prop","this","featureLayerOpts","worker","Worker","toUrl","onmessage","hitch","e","data","workerReady","postMessage","supercluster","superclusterReady","clusterWorkerReady","view","initClusterLayer","indexReady","clusterIndexReady","requestClusters","displayClusters","url","source","initial","map","reduce","console","log","currentFeatures","currentClusters","allViews","clusterFieldNames","fields","concat","filter","indexOf","popupTemplate","labelsVisible","labelSymbol","labelField","labelFormatter","renderer","geometryType","spatialReference","wkid","objectIdField","inherited","arguments","applyEdits","promise","source_layer","apply","when","loadFeatures","createLayerView","mapView","push","labelGraphics","graphics","add","destroyLayerView","splice","length","direct_url","load","then","definitionExpression","watch","newExp","oldExp","where","offset","workerOpts","mixin","features","direct_type","outFields","fieldname","query","num","maxRecordCount","start","outSpatialReference","returnGeometry","handleQueryResponse","results","esriObjectToJSON","exceededTransferLimit","queryFeatures","stationary","popup","selectedFeature","layer","zoom","parseInt","Math","round","extent","webMercatorToGeographic","basemap","baseLayers","items","fullExtent","bbox","xmin","ymin","xmax","ymax","clusters","graphicFromGeoJson","removeAll","addMany","cluster","attributes","point_count","geometry","obj","toJSON","geoJson","longitude","coordinates","latitude","properties"],"mappings":"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","file":"ClusterLayer.js"}